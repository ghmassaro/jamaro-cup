<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Jamaro Cup</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; background: #f8f8f8; }
    h1 { margin-bottom: 12px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; vertical-align: top; }
    th { background: #f0f0f0; text-align: left; }
    .status { font-weight: bold; text-transform: lowercase; }
    .accepted { color: #2e7d32; }
    .pending_review { color: #f57c00; }
    .duplicate { color: #6d4c41; }
    .rejected { color: #c62828; }
    .actions form { display: inline-block; margin-right: 6px; }
    .btn { padding: 6px 10px; border-radius: 6px; border: 1px solid #ddd; background:#fff; cursor:pointer; text-decoration:none; }
    .btn:hover { background:#f5f5f5; }
    a.link { padding: 6px 10px; border-radius: 6px; background:#eee; text-decoration:none; }
    .muted { color:#666; font-size:12px; }
  </style>
</head>
<body>
  <h1>
    <span>Admin — Inscrições</span>
    <a class="btn" href="/admin/export.xlsx" title="Exporta todas as inscrições para Excel">Exportar Excel</a>
  </h1>

  <div class="muted">Score = confiança da validação automática (0–100). Em imagens (sem OCR) tende a ser baixo/0.</div>

  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Dupla / Categoria</th>
        <th>Atleta 1</th>
        <th>Atleta 2</th>
        <th>Cidades</th>
        <th>Comprovante</th>
        <th>Score</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <% (entries || []).slice().reverse().forEach(e => { %>
        <tr>
          <td><%= new Date(e.submittedAt).toLocaleString('pt-BR') %></td>

          <td>
            <div><strong><%= e.duo?.name || '-' %></strong></div>
            <div><small>Categoria: <%= e.duo?.category || '-' %></small></div>
          </td>

          <td>
            <div><strong><%= e.athlete1?.name || '-' %></strong></div>
            <div><%= e.athlete1?.email || '' %></div>
            <div><small><%= e.athlete1?.phone || '' %></small></div>
          </td>

          <td>
            <div><strong><%= e.athlete2?.name || '-' %></strong></div>
            <div><%= e.athlete2?.email || '' %></div>
            <div><small><%= e.athlete2?.phone || '' %></small></div>
          </td>

          <td>
            <div><small>A1: <%= e.athlete1?.city || '-' %></small></div>
            <div><small>A2: <%= e.athlete2?.city || '-' %></small></div>
          </td>

          <td>
            <% if (e.paymentProofUrl) { %>
              <a class="link" href="<%= e.paymentProofUrl %>" target="_blank">Abrir</a>
            <% } else { %>
              -
            <% } %>
          </td>

          <td><%= (e.validation && e.validation.score != null) ? e.validation.score : '-' %></td>
          <td class="status <%= e.status %>"><%= e.status %></td>

          <td class="actions">
            <form method="POST" action="/admin/entries/<%= e.id %>/approve">
              <button class="btn" type="submit">Aprovar</button>
            </form>
            <form method="POST" action="/admin/entries/<%= e.id %>/reject">
              <button class="btn" type="submit">Reprovar</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</body>
</html>
