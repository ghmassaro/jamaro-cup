<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jamaro FTV - Inscrição</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; text-align: center; }
    header { background-color: #000; padding: 20px; }
    header img { height: 100px; }
    h1 { color: #333; margin-top: 20px; font-size: 24px; }

    /* Banner de categoria e valor */
    .info-banner {
      max-width: 900px; margin: 10px auto 0;
      background: #fffbe6; color: #5c4a00; border: 1px solid #ffe58f;
      border-radius: 10px; padding: 10px 14px; box-shadow: 0 2px 10px rgba(0,0,0,.06);
      text-align: left; font-size: 14px;
    }
    .info-banner strong { font-weight: 700; }
    .info-banner .dot { margin: 0 8px; opacity: .5; }

    form {
      width: 100%; max-width: 700px; margin: 16px auto 30px; background: #fff;
      padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      text-align: left;
    }
    fieldset {
      border: none; border-left: 4px solid #fdd835; padding: 20px 20px 10px;
      margin-bottom: 30px; border-radius: 8px; background: #fafafa;
    }
    legend { font-weight: bold; font-size: 18px; color: #222; margin-bottom: 10px; }
    label { display: block; margin: 12px 0 6px; font-weight: 600; color: #444; }
    input, select {
      width: 100%; padding: 12px; font-size: 15px; border: 1px solid #ccc; border-radius: 6px;
      box-sizing: border-box; transition: border .3s ease, box-shadow .2s ease;
    }
    input:focus, select:focus { border-color: #fdd835; outline: none; box-shadow: 0 0 0 3px rgba(253,216,53,.25); }

    /* Box amarelo reutilizável (termo e info de categoria) */
    .termo, .categoria-info {
      font-size: 14px;
      background: #fff8dc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #e1c870;
      line-height: 1.5;
    }
    .termo { max-height: 240px; overflow-y: auto; }
    .categoria-info { display: none; margin-top: 10px; }
    .categoria-info strong { display: block; margin-bottom: 6px; }

    /* Checkbox de termos */
    .accept-row { display: flex; align-items: flex-start; gap: 10px; margin-top: 10px; }
    .accept-row input[type="checkbox"] { width: 18px; height: 18px; margin-top: 3px; cursor: pointer; }
    .accept-row label { margin: 0; font-weight: 500; color: #333; cursor: pointer; }
    .hint { font-size: 13px; color: #666; margin-top: 6px; }

    button {
      background-color: #fdd835; border: none; padding: 14px 24px; color: #000; font-size: 16px;
      font-weight: bold; cursor: pointer; border-radius: 6px; display: block; margin: 0 auto;
      transition: background-color .3s ease, transform .06s ease;
    }
    button:disabled { background-color: #ddd; cursor: not-allowed; }
    button:hover:not(:disabled) { background-color: #fbc02d; }
    button:active:not(:disabled) { transform: translateY(1px); }

    @media (max-width: 480px) { form { padding: 20px; } .info-banner { margin: 10px 16px 0; } }

    /* Botão WhatsApp */
    .whatsapp-float {
      position: fixed; bottom: 20px; right: 20px; background-color: #25D366; border-radius: 50%;
      width: 60px; height: 60px; display: flex; justify-content: center; align-items: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); z-index: 999; transition: transform .3s ease;
    }
    .whatsapp-float:hover { transform: scale(1.1); }
    .whatsapp-float img { width: 32px; height: 32px; }
  </style>
</head>
<body>
  <header>
    <img src="/img/5.png" alt="Logo Jamaro" />
  </header>

  <h1>Formulário de Inscrição - Jamaro Cup</h1>

  <!-- Banner de categoria selecionada e valor -->
  <div id="categoryBanner" class="info-banner" hidden>
    <strong id="bannerCategory">Categoria selecionada: —</strong>
    <span class="dot">•</span>
    <span id="bannerPrice">Valor: R$ 300,00 a dupla</span>
  </div>

  <form id="inscricaoForm" action="/submit" method="POST" enctype="multipart/form-data" novalidate>
    <!-- Atleta 1 -->
    <fieldset>
      <legend>Atleta 1</legend>
      <label for="nome1">Nome Completo</label>
      <input type="text" id="nome1" name="entry.857165334" required />

      <label for="tel1">Telefone</label>
      <input type="tel" id="tel1" name="entry.222222222" required placeholder="(11) 99999-9999" inputmode="numeric" />

      <label for="email1">E-mail</label>
      <input type="email" id="email1" name="entry.444444444" required />

      <label for="cep1">CEP</label>
      <input type="text" id="cep1" name="entry.cep1" placeholder="00000-000" maxlength="9" required inputmode="numeric" autocomplete="postal-code" />

      <label for="city1">Cidade</label>
      <input type="text" id="city1" name="city1" readonly autocomplete="address-level2" />

      <label for="kit1">Kit (Tamanho)</label>
      <select id="kit1" name="entry.kit1" required>
        <option value="">Selecione...</option><option value="M">M</option><option value="G">G</option><option value="GG">GG</option>
      </select>
    </fieldset>

    <!-- Atleta 2 -->
    <fieldset>
      <legend>Atleta 2</legend>
      <label for="nome2">Nome Completo</label>
      <input type="text" id="nome2" name="entry.949098972" required />

      <label for="tel2">Telefone</label>
      <input type="tel" id="tel2" name="entry.333333333" required placeholder="(11) 99999-9999" inputmode="numeric" />

      <label for="email2">E-mail</label>
      <input type="email" id="email2" name="entry.555555555" required />

      <label for="cep2">CEP</label>
      <input type="text" id="cep2" name="entry.cep2" placeholder="00000-000" maxlength="9" required inputmode="numeric" autocomplete="postal-code" />

      <label for="city2">Cidade</label>
      <input type="text" id="city2" name="city2" readonly autocomplete="address-level2" />

      <label for="kit2">Kit (Tamanho)</label>
      <select id="kit2" name="entry.kit2" required>
        <option value="">Selecione...</option><option value="M">M</option><option value="G">G</option><option value="GG">GG</option>
      </select>
    </fieldset>

    <!-- Dados da Dupla -->
    <fieldset>
      <legend>Dados da Dupla</legend>
      <label for="duoName">Nome da Dupla</label>
      <input type="text" id="duoName" name="entry.111111111" required />

      <label for="category">Categoria</label>
      <select id="category" name="entry.666666666" required>
        <option value="">Selecione...</option>
        <option value="Aprendiz">Aprendiz</option>
        <option value="Iniciante B">Iniciante B</option>
        <option value="Iniciante A">Iniciante A</option>
        <option value="Intermediário">Intermediário</option>
        <option value="Amador">Amador</option>
        <option value="Misto Principiante">Misto Principiante</option>
        <option value="Misto Iniciante">Misto Iniciante</option>
      </select>

      <!-- Box informativo da categoria selecionada -->
      <div id="categoriaInfo" class="categoria-info">
        <strong>Informações da categoria</strong>
        <div id="categoriaInfoText">Selecione uma categoria para ver os detalhes.</div>
      </div>

      <label for="instagram">Instagram da Dupla</label>
      <input type="text" id="instagram" name="entry.622151674" />
    </fieldset>

    <!-- Termo de Consentimento (texto completo) -->
    <fieldset>
      <legend>Termo de Consentimento</legend>
      <div class="termo">
        <strong>Termo de Consentimento - 4ª Jamaro Cup</strong><br><br>
        Ao se inscrever na 4ª Jamaro Cup, o atleta e/ou sua dupla declara ter lido e concordado com todos os termos e condições descritos abaixo.<br><br>

        <strong>1. Reembolso de Inscrição:</strong><br>
        O atleta tem o direito de solicitar o reembolso integral da taxa de inscrição em até 7 dias após a data de confirmação do pagamento.<br>
        Para solicitar o reembolso, o atleta deve enviar um e-mail para <em>jamarocup@gmail.com</em> com o assunto "Reembolso 4ª Jamaro Cup", informando o nome completo do atleta e o comprovante de pagamento.<br>
        Após o prazo de 7 dias, a organização não fará qualquer reembolso, independentemente do motivo da desistência.<br><br>

        <strong>2. Nível de Categoria e Desclassificação:</strong><br>
        As duplas devem se inscrever na categoria que melhor representa o seu nível técnico.<br>
        A organização da 4ª Jamaro Cup se reserva o direito de avaliar o nível dos atletas inscritos.<br>
        Caso uma dupla seja identificada com um nível técnico acima da categoria em que se inscreveu, ela será desclassificada imediatamente do torneio.<br>
        A desclassificação por nível técnico não dará direito a reembolso da taxa de inscrição e nem a remanejamento para outra categoria.<br><br>

        <strong>3. Uniformes:</strong><br>
        Ao escolher o tamanho do uniforme no ato da inscrição, o atleta concorda que esta é uma decisão final e que não haverá direito à troca de tamanho, salvo em casos de defeito de fabricação comprovado.<br>
        Para que a produção dos uniformes seja feita de forma eficiente, a organização não se responsabiliza por tamanhos incorretos escolhidos pelos atletas.<br><br>

        <strong>4. Consentimento:</strong><br>
        O atleta e/ou sua dupla está ciente e concorda com as regras de reembolso, desclassificação por nível de categoria e uniformes.<br>
        A inscrição na 4ª Jamaro Cup implica na aceitação completa deste termo.
      </div>

      <!-- Checkbox moderno para aceitar termos -->
      <div class="accept-row">
        <input type="checkbox" id="acceptTerms" name="acceptTerms" value="Sim" required />
        <label for="acceptTerms">
          Li e aceito o Termo de Consentimento e autorizo o uso de imagem para fins de divulgação do evento.
        </label>
      </div>
      <div class="hint">O envio só será permitido após aceitar os termos.</div>
    </fieldset>

    <!-- Comprovante -->
    <fieldset>
      <legend>Comprovante de Pagamento</legend>
      <label for="paymentProof">Envie comprovante (PIX)</label>
      <input type="file" id="paymentProof" name="paymentProof" accept="image/*,.pdf" required />
    </fieldset>

    <button type="submit" id="submitBtn" disabled>Enviar Inscrição</button>
  </form>

  <script>
    // ===== Controle do botão de envio (aceitar termos) =====
    const accept = document.getElementById('acceptTerms');
    const submitBtn = document.getElementById('submitBtn');
    accept.addEventListener('change', function(){ submitBtn.disabled = !this.checked; });

    // ===== CEP: somente cidade, sem travar usuário =====
    function normalizeCEP(str) { return (str || '').replace(/\D/g, '').slice(0, 8); }

    async function preencherCidadePorCEP(cepInputId, cityInputId) {
      const cepEl = document.getElementById(cepInputId);
      const cityEl = document.getElementById(cityInputId);
      if (!cepEl || !cityEl) return;

      const cep = normalizeCEP(cepEl.value);

      // Formatação visual 00000-000
      cepEl.value = cep.length > 5 ? `${cep.slice(0,5)}-${cep.slice(5)}` : cep;

      // Se não tiver 8 dígitos, permite o usuário digitar a cidade e sai
      if (cep.length !== 8) {
        cityEl.readOnly = false;
        if (!cityEl.value) cityEl.placeholder = 'Digite sua cidade';
        return;
      }

      try {
        const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const data = await res.json();
        if (!data.erro && data.localidade) {
          cityEl.value = data.localidade;
          cityEl.readOnly = true;
          cityEl.placeholder = '';
        } else {
          // CEP não encontrado: deixa editar manualmente
          cityEl.value = '';
          cityEl.readOnly = false;
          cityEl.placeholder = 'Digite sua cidade';
        }
      } catch {
        // Falhou a consulta: não trava; deixa editar
        cityEl.readOnly = false;
        if (!cityEl.value) cityEl.placeholder = 'Digite sua cidade';
      }
    }

    function attachCEPHandlers(cepId, cityId) {
      const el = document.getElementById(cepId);
      if (!el) return;
      // Formata enquanto digita
      el.addEventListener('input', () => {
        const d = el.value.replace(/\D/g,'').slice(0,8);
        el.value = d.length > 5 ? `${d.slice(0,5)}-${d.slice(5)}` : d;
      });
      // Busca cidade ao sair do campo
      el.addEventListener('blur', () => preencherCidadePorCEP(cepId, cityId));
    }
    attachCEPHandlers('cep1','city1');
    attachCEPHandlers('cep2','city2');

    // ===== Telefone BR: máscara + validação (fixo/celular) =====
    const telRegex = /^\(\d{2}\)\s?(?:9\d{4}|\d{4})-\d{4}$/; // (11) 99999-9999 ou (11) 9999-9999

    function formatPhoneBR(value) {
      const d = (value || '').replace(/\D/g, '').slice(0, 11);
      if (d.length <= 10) { // fixo
        const p1 = d.slice(0,2), p2 = d.slice(2,6), p3 = d.slice(6,10);
        if (d.length > 6) return `(${p1}) ${p2}-${p3}`;
        if (d.length > 2) return `(${p1}) ${p2}`;
        if (d.length > 0) return `(${p1}`;
        return '';
      } else { // celular 11 dígitos
        const p1 = d.slice(0,2), p2 = d.slice(2,7), p3 = d.slice(7,11);
        return `(${p1}) ${p2}-${p3}`;
      }
    }

    function attachPhoneMask(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', () => {
        el.value = formatPhoneBR(el.value);
        el.setCustomValidity('');
      });
      el.addEventListener('blur', () => {
        if (el.value && !telRegex.test(el.value)) {
          el.setCustomValidity('Informe um telefone válido no formato (11) 99999-9999.');
          el.reportValidity();
        } else {
          el.setCustomValidity('');
        }
      });
    }
    attachPhoneMask('tel1');
    attachPhoneMask('tel2');

    // ===== Submit: verificação leve (não trava se ViaCEP cair) =====
    const form = document.getElementById('inscricaoForm');
    form.addEventListener('submit', (e) => {
      // Telefones
      const t1 = document.getElementById('tel1');
      const t2 = document.getElementById('tel2');
      let ok = true;
      [t1, t2].forEach(t => {
        if (!telRegex.test(t.value)) {
          t.setCustomValidity('Informe um telefone válido no formato (11) 99999-9999.');
          t.reportValidity();
          ok = false;
        } else {
          t.setCustomValidity('');
        }
      });

      // CEPs: só checa comprimento; cidade pode ser digitada manualmente
      const c1 = document.getElementById('cep1').value.replace(/\D/g,'');
      const c2 = document.getElementById('cep2').value.replace(/\D/g,'');
      if (c1.length !== 8 || c2.length !== 8) ok = false;

      if (!ok) {
        e.preventDefault();
        return;
      }

      // evita envio duplo
      submitBtn.disabled = true;
    });

    // ===== Categoria via URL + texto informativo =====
    (function(){
      const infos = {
        "Aprendiz": "Esta categoria é voltada para quem está iniciando na modalidade e ainda não possui experiência em torneios.",
        "Iniciante B": "Categoria para atletas com pouca experiência competitiva, focada em desenvolvimento técnico básico.",
        "Iniciante A": "Para atletas em transição para o nível intermediário, com fundamentos já consolidados.",
        "Intermediário": "Voltada a atletas com boa técnica e experiência de jogo, exigindo regularidade e leitura tática.",
        "Sub-21": "Categoria destinada para atletas com até 21 anos completos",
        "Misto Principiante": "Duplas mistas com atletas em fase inicial da modalidade. Espírito de aprendizado acima de tudo.",
        "Misto Iniciante": "Duplas mistas com atletas iniciantes em evolução, tolerando variação de níveis entre os parceiros."
      };
      function normalize(s){ return (s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,''); }

      const params = new URLSearchParams(location.search);
      const cat = params.get('categoria');
      const select = document.getElementById('category');
      const banner = document.getElementById('categoryBanner');
      const bannerCategory = document.getElementById('bannerCategory');
      const catBox = document.getElementById('categoriaInfo');
      const catText = document.getElementById('categoriaInfoText');

      if (select) {
        if (cat) {
          let found = false;
          [...select.options].forEach(o=>{
            if (!found && (o.value.toLowerCase() === cat.toLowerCase() ||
                           normalize(o.value).toLowerCase() === normalize(cat).toLowerCase())) {
              select.value = o.value; found = true;
            }
          });
          if (banner) banner.hidden = false;
          if (bannerCategory) bannerCategory.textContent = 'Categoria selecionada: ' + (select.value || cat);
          if (catBox) catBox.style.display = 'block';
          if (catText) catText.textContent = infos[select.value || cat] || "Selecione uma categoria para ver os detalhes.";
        }

        select.addEventListener('change', ()=>{
          if (banner) banner.hidden = false;
          if (bannerCategory) bannerCategory.textContent = 'Categoria selecionada: ' + select.value;
          if (catBox) catBox.style.display = 'block';
          if (catText) catText.textContent = infos[select.value] || "Selecione uma categoria para ver os detalhes.";
        });
      }
    })();
  </script>

  <!-- WhatsApp flutuante -->
  <a class="whatsapp-float" href="https://wa.me/5517997237635" target="_blank" title="Fale com a organização">
    <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
  </a>
</body>
</html>
